generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

model User {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String         @db.VarChar(50)
  email             String         @db.VarChar(255) @unique
  password          String         @db.VarChar(100)
  role              Role           @default(USER)
  products          Product[]
  cartItems         CartItem[]
  orders            Order[]
  reviews           Review[]
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt
}

model ProductImage {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId         String         @db.Uuid
  url               String         @db.VarChar(255)
  product           Product        @relation(fields: [productId], references: [id])
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt
}

model Product {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title             String         @db.VarChar(50)
  description       String         @db.VarChar(255)
  price             Decimal        @db.Decimal(10, 2)
  stock             Int            @default(0)
  popularity        Int            @default(0)
  ownerId           String         @db.Uuid
  owner             User           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  categoryId        String?        @db.Uuid
  category          Category?      @relation(fields: [categoryId], references: [id])
  images            ProductImage[]
  cartItems         CartItem[]
  orderItems        OrderItem[]
  reviews           Review[]
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt
}

model Category {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String         @unique
  products          Product[]
}

model CartItem {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String         @db.Uuid
  productId         String         @db.Uuid
  quantity          Int            @default(1)
  user              User           @relation(fields: [userId], references: [id])
  product           Product        @relation(fields: [productId], references: [id])
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt

  @@unique([userId, productId])
}

model Order {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String         @db.Uuid
  user              User           @relation(fields: [userId], references: [id])
  items             OrderItem[]
  status            OrderStatus    @default(PENDING)
  total             Decimal        @db.Decimal(10, 2)
  paymentStatus     PaymentStatus  @default(PENDING)
  paymentIntentId   String?
  reservedUntil     DateTime?
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt
}

model OrderItem {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId           String         @db.Uuid
  order             Order          @relation(fields: [orderId], references: [id])
  productId         String         @db.Uuid
  product           Product        @relation(fields: [productId], references: [id])
  quantity          Int
  price             Decimal        @db.Decimal(10, 2)
}

model Review {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId         String         @db.Uuid
  userId            String         @db.Uuid
  rating            Int            @default(0)
  comment           String         @db.VarChar(500)
  product           Product        @relation(fields: [productId], references: [id])
  user              User           @relation(fields: [userId], references: [id])
  createdAt         DateTime       @default(now()) @db.Timestamp(6)
  updatedAt         DateTime       @updatedAt

  @@unique([productId, userId])
}
